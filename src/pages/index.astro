---
import BaseLayout from "@/layouts/base.astro";
import { getEntry } from "astro:content";
import Headlines from "@/pages/_home/headlines.astro";
import LatestNews from "@/pages/_home/latestNews.astro";
import CategorySection from "@/pages/_home/categorySection.astro";
// 1. 引入分类数据处理器
import { categoriesHandler } from "@/lib/handlers/categories";

const entry = await getEntry("views", "home");

// 2. 获取所有已存在的分类 (这会自动读取 src/content/categories 下的所有文件夹)
const allCategories = categoriesHandler.allCategories();

if (!entry) {
  return Astro.redirect("/404");
}
---

<BaseLayout entry={entry}>
  <Headlines />
  
  <LatestNews />

  {/* 3. 动态渲染所有分类板块 */}
  {/* 使用 flex 容器来控制板块之间的垂直间距，gap-16 约等于 64px */}
  <div class="flex flex-col gap-16 md:gap-24 mb-20 mt-12">
    {
      allCategories.map((category) => (
        <CategorySection 
          title={category.data.title} 
          categoryId={category.id} 
          count={3} 
        />
      ))
    }
  </div>
</BaseLayout>